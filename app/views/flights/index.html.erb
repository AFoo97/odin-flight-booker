<h1>Book a Flight</h1>

<%= form_with url: flights_path, method: :get, local: true do %>
  <div>
    <%= label_tag :departure_airport_id, "From" %>
    <%= select_tag :departure_airport_id, options_from_collection_for_select(@airports, :id, :code, params[:departure_airport_id]) %>
  </div>

  <div>
    <%= label_tag :arrival_airport_id, "To" %>
    <%= select_tag :arrival_airport_id, options_from_collection_for_select(@airports, :id, :code, params[:arrival_airport_id]) %>
  </div>

  <div>
    <%= label_tag :date, "Date" %>
    <%= select_tag :date, options_for_select(@dates.map { |d| [d.strftime("%b %d, %Y"), d] }, params[:date]) %>
  </div>

  <div>
    <%= label_tag :num_tickets, "Passengers" %>
    <%= select_tag :num_tickets, options_for_select(@num_tickets, params[:num_tickets]) %>
  </div>

  <%= submit_tag "Search" %>
<% end %>

<% if @flights.present? %>
  <h2>Available Flights</h2>
  <%= form_with url: new_booking_path, method: :get, local: true do %>
    <% @flights.each do |flight| %>
      <div>
        <%= radio_button_tag :flight_id, flight.id %>
        <%= "#{flight.departure_airport.code} -> #{flight.arrival_airport.code}, #{flight.start_datetime.strftime('%b %d %H:%M')}" %>
      </div>
    <% end %>
    <%= hidden_field_tag :num_tickets, params[:num_tickets] %>
    <%= submit_tag "Book Flight" %>
  <% end %>
<% end %>

